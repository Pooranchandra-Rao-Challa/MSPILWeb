<div class="col-12">
  <div class="card">

    <!-- toolbar -->
    <p-toolbar styleClass="p-mb-4">
      <ng-template pTemplate="left">
        <h4>Plot Assesments</h4>
      </ng-template>
      <ng-template pTemplate="right">
        <button pButton pRipple label="New Plot Assesment" icon="pi pi-plus" class="p-button-success p-mr-2"
          (click)="initPlotAssesment()"></button>
      </ng-template>
    </p-toolbar>

    <!-- dialog -->
    <p-dialog header="Plot Assesment" [(visible)]="showDialog" [modal]="true"
      [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '75vw'}">
      <form [formGroup]="fbPlotAssesment" (ngSubmit)="onSubmit()">
        <p-tabView orientation="left">
          <p-tabPanel header="Plot Assesment" class="col-12">
            <div class="flex flex-column  justify-content-center">
              <div class="grid">
                <div class="col-12">
                  <p-fieldset legend="Season" [toggleable]="true" class="line-height-3 m-0"
                    [transitionOptions]="'500ms'">
                    <div class="p-fluid p-formgrid grid">
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Season:</label>
                        <p-dropdown class="ml-2" placeholder="Select a season" optionLabel="name" [options]="seasons"
                          optionValue="seasonId" formControlName="seasonId" (onChange)="initPlotReports($event.value)">
                        </p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Plot No:</label>
                        <!-- <input pInputText type="text" formControlName="plotReportId"
                                                    placeholder="Enter Plot No"> -->
                        <p-dropdown class="ml-2" placeholder="Select Plot" optionLabel="plotNumber"
                          [options]="plotReports" optionValue="plotReportId" formControlName="plotReportId">
                        </p-dropdown>
                      </div>
                    </div>
                  </p-fieldset>
                  <p-fieldset legend="Farmer Info" [toggleable]="true" class="col-12 mt-2"
                    [transitionOptions]="'500ms'">
                    <div class="p-fluid p-formgrid grid">
                      <!-- <div class="field col-12 md:col-4 lg:col-3 ">
                                                <label>Offered No:<sup class="p-error">*</sup></label>
                                                <input pInputText type="text" formControlName="offeredno"
                                                    placeholder="Enter Offered No">
                                            </div> -->
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Farmer Code:<sup class="p-error">*</sup></label>
                        <p-dropdown optionLabel="code" [options]="farmers" optionValue="farmerId" [filter]="true"
                          filterBy="code,aliasName,villageName" formControlName="farmerId" placeholder="Select Farmer"
                          (onChange)="onSelectedFarmer($event.value)">
                          <ng-template let-farmer pTemplate="selectedItem">
                            <div>{{farmer.code}}</div>
                          </ng-template>
                          <ng-template let-farmer pTemplate="item">
                            <div>{{farmer.code}}</div>
                            <div>Code: {{farmer.code}} Name:{{farmer.aliasName}} Village:{{farmer.villageName}}</div>
                          </ng-template>
                        </p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Farmer Name:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="farmername" readonly
                          placeholder="Enter Farmer Name">
                      </div>
                      <!-- <div class="field col-12 md:col-4 lg:col-3">
                                                <label>Father Name:<sup class="p-error">*</sup></label>
                                                <input pInputText type="text" formControlName="fathername" readonly
                                                    placeholder="Enter Father Name">
                                            </div> -->
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Farmer Village:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="farmervillage" readonly
                          placeholder="Enter Farmer Village">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Division:</label>
                        <input pInputText type="text" formControlName="division" readonly placeholder="Enter Division">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Circle:</label>
                        <input pInputText type="text" formControlName="circle" readonly placeholder="Enter  Circle">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Section:</label>
                        <input pInputText type="text" formControlName="section" readonly placeholder="Enter Section">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Crop Type:<sup class="p-error">*</sup></label>
                        <p-dropdown optionLabel="name" [options]="crops" optionValue="lookupDetailId"
                          formControlName="croptype" [autoDisplayFirst]="false"
                          placeholder="Select Crop Type"></p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Crop:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="crop" placeholder="Enter Crop">
                      </div>
                      <hr size="4" width="100%" >
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Reported Area:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="reportedarea" placeholder="Enter Reported Area">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Field Name:</label>
                        <input pInputText type="text" formControlName="fieldname" placeholder="Enter Field Name">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>BIR Number:</label>
                        <input pInputText type="text" formControlName="birnumber" placeholder="Enter BIR Number">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>BIR Date:</label>
                        <input pInputText type="text" formControlName="birdate" placeholder="Enter BIR Date">
                      </div>
                    </div>
                  </p-fieldset>
                  <p-fieldset legend="Cultivable Info" [toggleable]="true" class="col-12 mt-2"
                    [transitionOptions]="'500ms'">
                    <div class="p-fluid p-formgrid grid">
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Plant Type:<sup class="p-error">*</sup></label>
                        <p-dropdown optionLabel="name" optionValue="plantTypeId" [options]="planttypes"
                          placeholder="Select Plant Type"></p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Survey No:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="surveyno" placeholder="Enter Survey No">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Planting Date:<sup class="p-error">*</sup></label>
                        <p-calendar [readonlyInput]="true" [showIcon]="true" mask="99/99/9999"
                          formControlName="plantingdate" placeholder=" Please Select planting Date"></p-calendar>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Variety:<sup class="p-error">*</sup></label>
                        <p-dropdown optionLabel="name" optionValue="lookupDetailId" [options]="varitytype"
                          formControlName="variety" [autoDisplayFirst]="false"
                          placeholder="Select Variety"></p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Agreed Ton:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="agreedton" placeholder="Enter Agreed Ton">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Plot Type:<sup class="p-error">*</sup></label>
                        <p-dropdown optionLabel="name" optionValue="lookupDetailId" [options]="plottype"
                          formControlName="plottype" [autoDisplayFirst]="false"
                          placeholder="Select Plot Type"></p-dropdown>
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3 ">
                        <label>Measure Area:<sup class="p-error">*</sup></label>
                        <input pInputText type="text" formControlName="measurearea" placeholder="Enter Measure Area">
                      </div>
                      <div class="field col-12 md:col-4 lg:col-3">
                        <label>Inspection Date:<sup class="p-error">*</sup></label>
                        <p-calendar [readonlyInput]="true" [showIcon]="true" mask="99/99/9999"
                          formControlName="inspectiondate" placeholder=" Please Select Inspection Date"></p-calendar>
                      </div>
                      <div class="field col-12 md:col-6  lg:col-3 ">
                        <label>Demo Plot Area:</label><br>
                        <p-inputSwitch formControlName="demoplotarea"></p-inputSwitch>
                      </div>
                      <div class="field col-12 md:col-6  lg:col-3 ">
                        <label>Is Active:</label><br>
                        <p-inputSwitch formControlName="isactive"></p-inputSwitch>
                      </div>
                    </div>
                  </p-fieldset>
                </div>
              </div>
            </div>
          </p-tabPanel>
          <p-tabPanel header="Weedicide" class="line-height-3 m-0">
            <div class="flex flex-column  justify-content-center">
              <div class="grid">
                <div class="col-12">
                  <div class="p-fluid p-formgrid grid">
                    <div class="field col-12 md:col-4 lg:col-3 ">
                      <label>Weed Status:</label>
                      <p-dropdown optionLabel="name" optionValue="lookupDetailId" [options]="weedstatus"
                        formControlName="weedstatus" [autoDisplayFirst]="false"
                        placeholder="Select Weed Status"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-4 lg:col-3 ">
                      <label>Inter Croping:</label>
                      <p-dropdown optionLabel="name" [options]="cropstypes" optionValue="lookupDetailId"
                        formControlName="intercroping" [autoDisplayFirst]="false"
                        placeholder="Select Inter Croping"></p-dropdown>
                    </div>
                    <div class="field col-12 md:col-6  lg:col-3 ">
                      <label>Micronutrient Deficiency:</label><br>
                      <p-inputSwitch formControlName="micronutrientdeficiency"></p-inputSwitch>
                    </div>
                    <div class="field col-12 md:col-6  lg:col-3 ">
                      <label>Trash Mulching:</label><br>
                      <p-inputSwitch formControlName="trashmulching"></p-inputSwitch>
                    </div>
                    <div class="field col-12 md:col-6  lg:col-3 ">
                      <label>Gap Filing Done:</label><br>
                      <p-inputSwitch formControlName="gapfillingdone"></p-inputSwitch>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <p-tabView orientation="left">
              <p-tabPanel header="Weedicide">
                <div class="grid col-12">
                        <div formArrayName='weedicides'  class="checkboxList grid">
                    <ng-container *ngIf="this.fbPlotAssesment.controls['weedicides'] as formArray">
                      <div 
                        *ngFor="let item of getFormArrayControl('weedicides').controls; let i = index" class="col-2">
                        <div [formGroupName]="i"  style="padding-left:unset">
                          <p-inputSwitch [(ngModel)]="item.value.checked!" [ngModelOptions]="{standalone: true}">
                          </p-inputSwitch>{{item.value.name}}
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </div>  
              </p-tabPanel>
           
              <p-tabPanel header="Pests" class="col-12" >
                <div class="col-12" >
                  <p-table #dt2 dataKey="id" [value]="pests" [rows]="10" [rowHover]="true"   
                    styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm" [paginator]="false"
                    [autoLayout]="true" responsiveLayout="scroll" [rowsPerPageOptions]="[10,25,50]">
                    <ng-template pTemplate="header">
                      <tr>
                        <th>Name</th>
                        <th>Identified Date</th>
                        <th>Control Date</th>
                        <th>Remarks</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-pest>
                      <tr >
                        <td>
                          <input pInputText  [value]="pest.name">
                        </td>
                        <td>
                          <p-calendar [readonlyInput]="true" [showIcon]="true" mask="99/99/9999"
                            placeholder=" Please Select Identified Date">
                          </p-calendar>
                        </td>
                        <td>
                          <p-calendar [readonlyInput]="true" [showIcon]="true"  mask="99/99/9999"
                            placeholder=" Please Select Control Date">
                          </p-calendar>
                        </td>
                        <td>
                          <input pInputText [value]="pest.remarks" >
                        </td>
                      </tr>

                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                      <tr>
                          <td colspan="8">No customers found.</td>
                      </tr>
                  </ng-template>
                  </p-table>
                </div>
              </p-tabPanel>
            </p-tabView>
          </p-tabPanel>
          <p-tabPanel header="Fertilizer/Disease" class="line-height-3 m-0">
            <p-tabView orientation="left">
              <p-tabPanel header="Fertilizers " class="col-12">
                <div class="grid col-12">
                  <div formArrayName='fertilizers'  class="checkboxList grid">
              <ng-container *ngIf="this.fbPlotAssesment.controls['fertilizers'] as formArray">
                <div 
                  *ngFor="let item of getFormArrayControl('fertilizers').controls; let i = index" class="col-2">
                  <div [formGroupName]="i"  style="padding-left:unset">
                    <p-inputSwitch [(ngModel)]="item.value.checked!" [ngModelOptions]="{standalone: true}">
                    </p-inputSwitch>{{item.value.name}}
                  </div>
                </div>
              </ng-container>
            </div>
          </div>  
              </p-tabPanel>
              <p-tabPanel header="Diseases" class="col-12">
                <div class="col-12">
                  <p-table #dt2 dataKey="id" [value]="Diseases" [rows]="10" [rowHover]="true"
                    styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm" [paginator]="false"
                    [autoLayout]="true" responsiveLayout="scroll" [rowsPerPageOptions]="[10,25,50]">>
                    <ng-template pTemplate="header">
                      <tr>
                        <th>Name</th>
                        <th>Identified Date</th>
                        <th>Control Date</th>
                        <th>Remarks</th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-diseases>
                      <tr>
                        <td>
                          <input pInputText [value]="diseases.name">
                        </td>
                        <td>
                          <p-calendar [readonlyInput]="true" [showIcon]="true" mask="99/99/9999"
                            placeholder="Please Select Identified Date">
                          </p-calendar>
                        </td>
                        <td>
                          <p-calendar [readonlyInput]="true" [showIcon]="true" mask="99/99/9999"
                            placeholder="Please Select Control Date">
                          </p-calendar>
                        </td>
                        <td>
                          <input pInputText [value]="diseases.remarks">
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </p-tabPanel>
            </p-tabView>
          </p-tabPanel>
        </p-tabView>
      </form>
      <ng-template pTemplate="footer">
        <div class="col-12">
          <div class="col-4" style="float:right">
            <button pButton pRipple type="submit" label="{{submitLabel}}" class="p-button-raised p-button-success"
              (click)="onSubmit()"></button>
          </div>
        </div>
      </ng-template>
    </p-dialog>
    <!-- table -->
    <p-table #dt1 dataKey="id" [value]="plotAssessments" [rows]="10" [rowHover]="true"
      styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm" [paginator]="true" [autoLayout]="true"
      responsiveLayout="scroll" [rowsPerPageOptions]="[10,25,50]" [tableStyle]="{ width: 'max-content'}">
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between flex-column sm:flex-row">
          <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
            (click)="clear(dt1)"></button>
          <div>
            <span class="p-input-icon-left mb-2">
              <i class="pi pi-search"></i>
              <input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)" placeholder="Search Keyword"
                class="w-full">
            </span>
            <p-dropdown class="ml-2" placeholder="Select a season" optionLabel="name" [options]="seasons"
              [(ngModel)]="currentSeason.seasonId" (onChange)="initPlotAssesments($event.value)" optionValue="seasonId">
            </p-dropdown>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th></th>
          <th *ngFor="let col of headers" [pSortableColumn]="col.header">
            {{col?.label}} <p-sortIcon field="code">
            </p-sortIcon>
            <p-columnFilter type="text" [field]="col.header" display="menu"></p-columnFilter>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-plotTransfer>
        <tr>
          <td><button pButton pRipple icon="pi pi-pencil" class="p-element p-ripple p-button-text p-button p-component"></button>
          </td>
          <td *ngFor="let col of headers">
            <span >{{plotTransfer[col.field]}}</span>
            <span *ngIf="col?.field == 'assessedDate' ||col?.field == 'assessedDate'">
              {{plotTransfer[col.field] | date: 'dd-MM-yyyy'}}      
            </span>

          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="20" class="md:text-center">No Plot Assesment Found.</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="loadingbody">
        <tr>
          <td colspan="20" class="md:text-center">Loading Plot Assesment Data. Please wait.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
