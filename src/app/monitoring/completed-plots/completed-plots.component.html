<div class="col-12">
    <div class="card">
  
      <!-- toolbar -->
      <p-toolbar styleClass="p-mb-4">
        <ng-template pTemplate="left">
          <h4>Compleated Plots</h4>
        </ng-template>
        <ng-template pTemplate="right">
          <button pButton pRipple label="New Compleated Plot" icon="pi pi-plus" class="p-button-success p-mr-2"
            (click)="addCompleatedPlot()"></button>
        </ng-template>
      </p-toolbar>
  
      <!-- dialog -->
      <p-dialog header="Compleated Plot"  [(visible)]="showDialog" [modal]="true"
        [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '60vw'}">
        <div class="flex flex-column  justify-content-center">
          <form [formGroup]="fbCompletedPlots" (ngSubmit)="onSubmit()">
            <div class="grid">
              <div class="col-12">
                <div class="p-fluid p-formgrid grid">
                  <p-fieldset legend="Season Info"class="col-12"[toggleable]="true" [transitionOptions]="'500ms'">
                    <div class="p-fluid p-formgrid grid">
                    <div class="field col-12 md:col-4">
                      <label>Season:<sup class="p-error">*</sup></label>
                          <p-dropdown placeholder="Select Season" optionLabel="code" [options]="seasons"
                            optionValue="seasonId" formControlName="seasonId" (onChange)="getNewDocNo($event.value)"
                            [ngClass]="{ 'is-invalid ng-dirty': FormControls['seasonId'].touched && FormControls['seasonId'].errors }">
                          </p-dropdown>
                          <span *ngIf="FormControls['seasonId'].touched && FormControls['seasonId'].invalid">
                            <div class="ng-invalid ng-touched p-error"
                              *ngIf="FormControls['seasonId'].errors?.['required']">
                              Please Select Season.</div>
                          </span>
                        </div>
                    
                        <div class="field col-12 md:col-4">
                          <label> Plot No:<sup class="p-error">*</sup></label>
                       <input pInputText id="name" type="number"formControlName='plotAssessmentId' placeholder="Enter Plot No">
                        </div>
                        <div class="field col-12 md:col-4"></div>
                        <!-- (onChange)="getNewOfferNo($event.value)" -->
                        <div class="field col-12 md:col-4">
                          <label>Doc No:</label>
                          <input pInputText id="offerNo" type="text" placeholder="Doc No" formControlName="docNo" readonly>
                        </div>
                    <div class="field col-12 md:col-4">
                      <label>Doc Date:<sup class="p-error">*</sup></label>
                      <p-calendar formControlName="docDate" placeholder="Select Doc Date" [readonlyInput]="true" [showIcon]="true"
                      [ngClass]="{ 'is-invalid ng-dirty': FormControls['docDate'].touched && FormControls['docDate'].errors }">
                      </p-calendar>
                      <span *ngIf="FormControls['docDate'].touched && FormControls['docDate'].invalid">
                        <div class="ng-invalid ng-touched p-error"
                          *ngIf="FormControls['docDate'].errors?.['required']">
                          Please Select Doc Date.</div>
                      </span>
  
                  </div>
  
                </div>
                </p-fieldset>
  
                 
                <p-fieldset legend="Farmer Info" class="col-12" [toggleable]="true" [transitionOptions]="'500ms'">
                  <div class="p-fluid p-formgrid grid">
                  <div class="field col-12 md:col-4">
                      <label>Farmer Code:<sup class="p-error">*</sup></label>
                      <p-dropdown optionLabel="code" [options]="toFarmers" formControlName="farmerId" optionValue="farmerId" [filter]="true"
                      filterBy="code,farmerName," placeholder="Select Farmer"
                      (onChange)="onSelectedToFarmer($event.value)">
                      <ng-template let-toFarmers pTemplate="selectedItem">
                        <div>{{toFarmers.code}}</div>
                      </ng-template>
                      <ng-template let-toFarmers pTemplate="item">
                        <div>{{toFarmers.code}}</div>
                        <div>Code: {{toFarmers.code}} Name:{{toFarmers.toFarmerName}} Estimated Ton: {{toFarmers.estimatedTon}}</div>
                      </ng-template>
                    </p-dropdown>
                    
                  </div>
              
                  <div class="field col-12 md:col-4">
                    <label>To Farmer Name:</label>
                    <input pInputText id="toFarmerName" placeholder="Farmer Name" formControlName="toFarmerName" type="text" readonly>
                  </div>
                    
                    <div class="field col-12 md:col-4">
                      <label> Estimated Ton:<sup class="p-error">*</sup></label>
                      <input pInputText id="estimatedTon" type="text" formControlName="estimatedTon" placeholder="Enter Estimated Ton" readonly>
                  </div>
                  <div class="field col-12 md:col-4">
                      <label> Supplied Ton:<sup class="p-error">*</sup></label>
                      <input pInputText id="name" type="text" placeholder="EnterSupplied Ton">
                  </div>

                  <div class="field col-12 md:col-4">
                      <label>Net Area:<sup class="p-error">*</sup></label>
                      <input pInputText id="name" type="text" placeholder="Enter Net Area">
                  </div>

                  <div class="field col-12 md:col-4">
                      <label>Last Weighment Date:<sup class="p-error">*</sup></label>
                      <p-calendar placeholder="Select Last Weighment Date" [readonlyInput]="true"
                          [showIcon]="true">
                      </p-calendar>
                  </div>
            
            <div class="field col-12 md:col-2 mt-5">
              <label>Is Over:</label><br>
              <p-inputSwitch formControlName="isCompleted"></p-inputSwitch>
          </div>

          <div class="field col-12 md:col-2 mt-5">
              <label>Is Left Over?:</label><br>
              <p-inputSwitch formControlName="isLeftCultivation"></p-inputSwitch>
          </div>

          <div class="field col-12 md:col-2 mt-5">
              <label>Is Ratoon?:</label><br>
              <p-inputSwitch formControlName="isUsedForRatoon"></p-inputSwitch>
          </div>
                  </div>
                 </p-fieldset>                
                  
                </div>
              </div>
            </div>
          </form>
        </div>
        <ng-template pTemplate="footer">
          <div class="col-12">
            <div class="col-4" style="float:right">
              <button pButton pRipple type="submit" label="{{submitLabel}}"
              (click)="onSubmit()" class="p-button-raised p-button-success"></button>
            </div>
          </div>
        </ng-template>
      </p-dialog>
  
      <!-- table -->
      <p-table #dt1 dataKey="id" [value]="completedPlots" [columns]="headers" [rows]="10" [rowHover]="true"
        styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm" [paginator]="true" [autoLayout]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [showCurrentPageReport]="true"
        responsiveLayout="scroll" [rowsPerPageOptions]="[10,25,50]" [tableStyle]="{ width: 'max-content'}">
        <ng-template pTemplate="caption">
          <div class="flex justify-content-between flex-column sm:flex-row">
            <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
              (click)="clear(dt1)"></button>
            <div>
              <span class="p-input-icon-left mb-2">
                <i class="pi pi-search"></i>
                <input pInputText type="text" #filter (input)="onSearch()" placeholder="Search Keyword"
                  pTooltip="Search By Farmer Name, Village Name, Offer No" class="w-full" />
              </span>
              <p-dropdown class="ml-2" placeholder="Select a season" optionLabel="name" [options]="seasons"
                [(ngModel)]="currentSeason.seasonId" (onChange)="initCompleatedPlot($event.value)" optionValue="seasonId">
              </p-dropdown>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th></th>
            <th *ngFor="let col of headers" [pSortableColumn]="col.header">
              {{col?.label}} <p-sortIcon field="code">
              </p-sortIcon>
              <p-columnFilter type="text" [field]="col.header" display="menu"></p-columnFilter>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-completedPlot>
          <tr>
            <td><button pButton pRipple icon="pi pi-pencil" class="p-element p-ripple p-button-text p-button p-component"
                (click)="editCompleatedPlot(completedPlot)"></button>
            </td>
            <td *ngFor="let col of headers">
              <span *ngIf="col?.field != 'docDate' && col?.field != 'plantingDate'">{{completedPlot[col.field]}}</span>
              <span *ngIf="col?.field == 'docDate' || col?.field == 'plantingDate'">
                {{completedPlot[col.field] | date: 'dd-MM-yyyy'}}
              </span>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="20" class="md:text-center">No Plot Transfers Found.</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="20" class="md:text-center">Loading Plot Transfers Data. Please wait.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>